/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Nextflow config file for MPGI local equipment
- Profile for running on local MPGI servers or workstations
- Sets resource limits and Apptainer options for local execution
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

// -----------------------------
// Process resource limits
// -----------------------------
process {
    errorStrategy = { task.attempt < 3 ? 'retry' : 'ignore' }
    maxRetries = 2
    resourceLimits = [
        cpus: 32,           // Max CPUs per process (test)
        memory: '100.GB',   // Max memory per process (test)
        time: '120.h'        // Max time per process (test)
    ]
}

// -----------------------------
// Pipeline parameter overrides
// -----------------------------
params {
    publish_dir_mode = 'link' // Use symlinks for output files (faster on local filesystems)
    max_memory       = '100G' // Maximum memory per process
    max_cpus         = 32     // Maximum CPUs per process
    max_time         = '168h' // Maximum runtime per process (1 week)
}

// -----------------------------
// Apptainer (Singularity) container options
// -----------------------------
apptainer {
    enabled    = true                 // Enable Apptainer for containerized execution
    autoMounts = true                 // Automatically mount common host paths
    runOptions = '--writable-tmpfs'   // Use writable tmpfs for container
    cacheDir   = "/data/Platform/simages/" // Set custom cache directory for images
}
